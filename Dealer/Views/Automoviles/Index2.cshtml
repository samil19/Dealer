@using Microsoft.AspNet.Identity

@model PagedList.IPagedList<Dealer.Automovil>
@using PagedList.Mvc;
<link href="~/Content/PagedList.css" rel="stylesheet" type="text/css" />
@{
    ViewBag.Title = "Index2";
}
<style type="text/css">.block { }

 .call { }
</style>
<script src="@Url.Content("https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js")" type="text/javascript"></script>
<script src="@Url.Content("https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js")" type="text/javascript"></script>
<h2>Index2</h2>
<script>
                $(document).ready(function() {
                    Verificar();
                    $("#mandar").click(function() {
                        aplicar();
                    });
                    $(".call").click(function () {
                        if ('@User.Identity.GetUserId()' != '') {
                            $.ajax({
                                url: '@Url.Action("Agregar", "Automoviles")',
                                data: { ID: this.id }
                            });
                            document.getElementById(this.id).disabled = true;
                            $("#" + this.id).text("Agregado a tus Guardados");
                        } else {
                            alert("Debes iniciar sesion!");
                        }
                    });

                    $(".call1").click(function () {
                        window.location = $(this).data("href");
                    });
                });

    

                function aplicar() {
                    var h = $('#force1 option:selected').text();
                    var r = $('#force2 option:selected').text();
                    var q = $('#force3 option:selected').text();
                    var z = $('#force4 option:selected').text();
                    var x = $('#force5 option:selected').text();

                    $('#primero').val(h);
                    $('#segundo').val(r);
                    $('#tercero').val(q);
                    $('#cuarto').val(z);
                    $('#quinto').val(x);
                }
                function Verificar() {
                    $.ajax({
                        type: 'get',
                        dataType: "Json",
                        url: '@Url.Action("Verificar", "Saved")',
                        success: function(data) {
                            data.forEach(function(element)
                            {
                                console.log("IDs= " + " " + element);
                                bloquear(element);
                            });
                            console.log("Length= " + data.length);
                }
                    });
                    function bloquear(id) {
                        //document.getElementById(id).disabled = true;
                        $("#" + id).attr("disabled", "true");
                        $("#" + id).text("Agregado a tus Guardados");
                    }
                }
</script>

@using (Html.BeginForm())
{
    <p>
        @using (Html.BeginForm("Index2", "Automoviles"))
        {
            <div class="form-inline">
            <div class="col-md-3">
                    Marca
                    @Html.DropDownList("ID_Marca", null, "", htmlAttributes: new {@class = "form-control", id = "force1", @data_placeholder = "whatever"})
                <input type="text" name="searchString2" id="primero" hidden @ViewBag.CurrentFilter2 as string>
                    </div>
           <div class="col-md-3">
                Modelo
                @Html.TextBox("searchString", ViewBag.CurrentFilter as string, new { @class="form-control"})
            </div>
                <div class="col-md-3">
                    Tipo de Automovil
                    @Html.DropDownList("ID_Tipo", null, "", htmlAttributes: new {@class = "form-control", id = "force2", @name = "searchString3"})
                    <input type="text" name="searchString3" id="segundo" hidden @ViewBag.CurrentFilter3 as string>
                        
                </div>
                <div class="col-md-3">
                    Tipo de Transmision
                    @Html.DropDownList("ID_TipoTrans", null, "", htmlAttributes: new { @class = "form-control", id = "force4", @name = "searchString7" })
                    
                    <input type="text" name="searchString7" id="cuarto" hidden @ViewBag.CurrentFilter7 as string>
                </div>
                <div class="col-md-3">
                    Tipo de moneda
                    @Html.TextBox("searchString1", ViewBag.CurrentFilter1 as string, new { @class = "form-control" })
                </div>
           <div class="col-md-3">
                                    Cantidad de Pasajeros
                                    @Html.DropDownList("ID_CantPasajeros", null, "", htmlAttributes: new { @class = "form-control", id = "force3", @name = "searchString4" })
               <input type="text" name="searchString4" id="tercero" hidden @ViewBag.CurrentFilter4 as string>
               </div>
           <div class="col-md-3">
                                        Año
                                        @Html.DropDownList("SearchString5", Enumerable.Range(1940, DateTime.Now.Year - 1940 + 1).Select(i => new SelectListItem { Text = i.ToString(), Value = i.ToString() }) , "Please select year", new { @class = "form-control", @id = "force5"})
               <input type="text" id="quinto" hidden @ViewBag.CurrentFilter5 as string>
           </div>
           <div class="col-md-3">
                                            Precio @Html.TextBox("SearchString6", ViewBag.CurrentFilter6 as string, new { @class = "form-control" })
                                        </div>
            </div>
            <div class="col-md-10">
            <button type="submit" value="Search" id="mandar" class="btn btn-primary" style="margin:10px;">Buscar</button>
            </div>
        }
        
        <!--Find by name: 
        <input type="submit" value="Search"/>-->
    </p>
}
<!--Table with bootstrap class .table and .table-condensed-->
<table class="table table-condensed"></table>

    <table class="table">

        @foreach (var item in Model)
        {
            
            <tr data-href='AutoDetails/@item.ID_Auto'>
                <div class='call1' style="cursor: pointer;">
                    <td>
                        @Html.DisplayFor(modelItem => item.Modelo)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.Año_Fabricacion)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.Precio)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.Tipo_Moneda)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.Cant_Pasajeros.ID_CanPasajeros)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.Marca.Marca1)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.Tipo_Automovil.Tipo)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.Tipo_Trans.Tipo_Trans1)
                    </td>
                </div>
                    <td>
                        <button class="btn btn-primary call" id="@item.ID_Auto" style="z-index:1;">Agregar a Guardados</button>
                    </td>
</tr>
               
        }

    </table>
Page @(Model.PageCount < Model.PageNumber ? 0 : Model.PageNumber) of @Model.PageCount

@Html.PagedListPager(Model, page => Url.Action("Index2",
    new { page, currentFilter = ViewBag.CurrentFilter, currentFilter2 = ViewBag.CurrentFilter2, currentFilter3 = ViewBag.CurrentFilter3, currentFilter4 = ViewBag.CurrentFilter4, currentFilter5 = ViewBag.CurrentFilter5, currentFilter6 = ViewBag.CurrentFilter6, currentFilter7 = ViewBag.CurrentFilter7 }))